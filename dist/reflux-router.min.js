// v 1.0.1
// By Bryan Grezeszak 2016
// MIT License

!function(e,t){"function"==typeof define&&define.amd&&define(t),"object"==typeof module&&module.exports&&(module.exports=t()),"object"==typeof e&&"undefined"!=typeof Reflux&&(e.RefluxRouter=t())}(this,function(){"use strict"
function e(e){return e?e.replace(/^([^\/])|([^\/])$/g,"$2/$1"):"/"}function t(e){e&&e.state&&e.state.reflux_route?o.navigateTo(e.state.reflux_route,!0):o.navigateTo(o._defaultRoute,!0)}function n(e){var t=location.hash.substr(a.length)
o.navigateTo(t,!0)}var o={},r="undefined"!=typeof Reflux?Reflux:null,i=!1,a=null,u="object"==typeof window,l="object"==typeof document
return o._definedRoutes={},o._regexRoutes=[],o._routingMarker=null,o.defineReflux=function(e){r=e},o.initializeRouting=function(r,l,f){o._defaultRoute=e(r)
var s=f||(u?window.location.href:"")
s=s.replace(/\/$/,""),o._routingMarker=l=l.replace(/\/$/,"")
var d,c=s.indexOf(l)
if(i="#"===l.charAt(0),a=i?l:null,i&&u?window.addEventListener("hashchange",n):u&&window.addEventListener("popstate",t),i&&-1===c)d="/"
else if(-1===c)throw Error("Routing marker not found in current URL.")
return d=d||e(s.substr(c+l.length)),o.navigateTo(d,!0)},o.defineRoute=function(t,n,r,i){if(Array.isArray(r))var a=r
else{i=r
var a=void 0}if(Array.isArray(t))for(var u=0,l=t.length;l>u;u++)o.defineRoute(t[u],n,a,i)
else"string"==typeof t?(t=e(t),o._definedRoutes[t]={action:n,argmnts:a,title:i}):o._regexRoutes.push({regex:t,action:n,argmnts:a,title:i})},o.defineRouteState=function(t,n,r){if(Array.isArray(t))for(var i=0,a=t.length;a>i;i++)o.defineRouteState(t[i],n,r)
else"string"==typeof t?(t=e(t),o._definedRoutes[t]={state:n,title:r}):o._regexRoutes.push({regex:t,state:n,title:r})},o.navigateTo=function(t,n){t=e(t),"/"!==t&&t||(t=o._defaultRoute)
var i,a=o._definedRoutes[t],f=""
if(!a)for(var s=0,d=o._regexRoutes.length;d>s;s++)i=o._regexRoutes[s],t.match(i.regex)&&(i.action?i.action.apply(null,i.argmnts):i.state&&r.setGlobalState(i.state),i.title&&(f=i.title.replace(/\{title\}/,f)))
if(u&&!n){var c=o._routingMarker,g=location.href,R=g.substring(0,g.indexOf(c)+c.length)
window.history.pushState({reflux_route:t},(a?a.title:f)||null,R+t)}a&&(a.action?a.action.apply(null,a.argmnts):a.state&&r.setGlobalState(a.state))
var p=a&&a.title||f
return l&&p&&(document.title=p),p||null},o})
