// v 1.3.0
// By Bryan Grezeszak 2018
// MIT License

!function(e,t){"function"==typeof define&&define.amd&&define(t),"object"==typeof module&&module.exports&&(module.exports=t()),"object"==typeof e&&"undefined"!=typeof Reflux&&(e.RefluxRouter=t())}(this,function(){"use strict";var e="Routing marker not found in current URL.",t={},n="undefined"!=typeof Reflux?Reflux:null,r=!1,i=null,o="object"==typeof window,a="object"==typeof document;function l(e,t){return t=!1!==t,e?t?e.replace(/^([^\/])|([^\/])$/g,"$2/$1"):e.replace(/^([^\/])/,"/$1").replace(/\/$/,""):"/"}function u(){var n=window.location.href;n=n.replace(/\/$/,"");var r=t._routingMarker,i=n.indexOf(r);if(-1===i)throw new Error(e);return l(n.substr(i+r.length),t.trailingSlash)}function f(e){e&&e.state&&e.state.reflux_route?t.navigateTo(e.state.reflux_route,!0):t.navigateTo(u(),!0)}function s(e){var n=location.hash.substr(i.length);t.navigateTo(n,!0)}return t._definedRoutes={},t._regexRoutes=[],t._routingMarker=null,t.trailingSlash=!0,t.defineReflux=function(e){n=e},t.initializeRouting=function(n,a,u){t._defaultRoute=l(n,t.trailingSlash);var c=u||(o?window.location.href:"");c=c.replace(/\/$/,""),t._routingMarker=a=a.replace(/\/$/,"");var d,g=c.indexOf(a);if(r="#"===a.charAt(0),i=r?a:null,r&&o?window.addEventListener("hashchange",s):o&&window.addEventListener("popstate",f),r&&-1===g)d="/";else if(-1===g)throw new Error(e);return d=d||l(c.substr(g+a.length),t.trailingSlash),t.navigateTo(d,!0)},t.defineRoute=function(e,n,r,i){if(Array.isArray(r))var o=r;else{i=r;o=void 0}if(Array.isArray(e))for(var a=0,u=e.length;a<u;a++)t.defineRoute(e[a],n,o,i);else"string"==typeof e?(e=l(e,t.trailingSlash),t._definedRoutes[e]={action:n,argmnts:o,title:i}):t._regexRoutes.push({regex:e,action:n,argmnts:o,title:i})},t.defineRouteState=function(e,n,r){if(Array.isArray(e))for(var i=0,o=e.length;i<o;i++)t.defineRouteState(e[i],n,r);else"string"==typeof e?(e=l(e,t.trailingSlash),t._definedRoutes[e]={state:n,title:r}):t._regexRoutes.push({regex:e,state:n,title:r})},t.onUnknownRoute=function(e){},t.navigateTo=function(e,r,i){"/"!==(e=l(e,t.trailingSlash))&&e||(e=t._defaultRoute);var u,f=t._definedRoutes[e],s="",c=!1;if(!f)for(var d=0,g=t._regexRoutes.length;d<g;d++)u=t._regexRoutes[d],e.match(u.regex)&&(c=!0,u.action?u.action.apply(null,u.argmnts):u.state&&n.setGlobalState(u.state),u.title&&(s=u.title.replace(/\{title\}/,s)));if(o&&!r){var h=t._routingMarker,p=location.href,R=p.substring(0,p.indexOf(h)+h.length),v=e===t._defaultRoute?R:R+e;i?window.history.replaceState({reflux_route:e},(f?f.title:s)||null,v):window.history.pushState({reflux_route:e},(f?f.title:s)||null,v)}f&&(f.action?f.action.apply(null,f.argmnts):f.state&&n.setGlobalState(f.state));var x=f&&f.title||s;return a&&x&&(document.title=x),f||c||t.onUnknownRoute(e),x||null},t.redirectTo=function(e){return t.navigateTo(e,!1,!0)},t.getRoute=function(){return r?l(location.hash.substr(i.length),t.trailingSlash):u()},t});
