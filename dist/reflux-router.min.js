// v 1.1.0
// By Bryan Grezeszak 2016
// MIT License

!function(e,t){"function"==typeof define&&define.amd&&define(t),"object"==typeof module&&module.exports&&(module.exports=t()),"object"==typeof e&&"undefined"!=typeof Reflux&&(e.RefluxRouter=t())}(this,function(){"use strict"
function e(e){return e?e.replace(/^([^\/])|([^\/])$/g,"$2/$1"):"/"}function t(){var t=window.location.href
t=t.replace(/\/$/,"")
var n=i._routingMarker,o=t.indexOf(n)
if(-1===o)throw Error(r)
return e(t.substr(o+n.length))}function n(e){e&&e.state&&e.state.reflux_route?i.navigateTo(e.state.reflux_route,!0):i.navigateTo(t(),!0)}function o(e){var t=location.hash.substr(l.length)
i.navigateTo(t,!0)}var r="Routing marker not found in current URL.",i={},a="undefined"!=typeof Reflux?Reflux:null,u=!1,l=null,f="object"==typeof window,s="object"==typeof document
return i._definedRoutes={},i._regexRoutes=[],i._routingMarker=null,i.defineReflux=function(e){a=e},i.initializeRouting=function(t,a,s){i._defaultRoute=e(t)
var d=s||(f?window.location.href:"")
d=d.replace(/\/$/,""),i._routingMarker=a=a.replace(/\/$/,"")
var c,g=d.indexOf(a)
if(u="#"===a.charAt(0),l=u?a:null,u&&f?window.addEventListener("hashchange",o):f&&window.addEventListener("popstate",n),u&&-1===g)c="/"
else if(-1===g)throw Error(r)
return c=c||e(d.substr(g+a.length)),i.navigateTo(c,!0)},i.defineRoute=function(t,n,o,r){if(Array.isArray(o))var a=o
else{r=o
var a=void 0}if(Array.isArray(t))for(var u=0,l=t.length;l>u;u++)i.defineRoute(t[u],n,a,r)
else"string"==typeof t?(t=e(t),i._definedRoutes[t]={action:n,argmnts:a,title:r}):i._regexRoutes.push({regex:t,action:n,argmnts:a,title:r})},i.defineRouteState=function(t,n,o){if(Array.isArray(t))for(var r=0,a=t.length;a>r;r++)i.defineRouteState(t[r],n,o)
else"string"==typeof t?(t=e(t),i._definedRoutes[t]={state:n,title:o}):i._regexRoutes.push({regex:t,state:n,title:o})},i.onUnknownRoute=function(e){},i.navigateTo=function(t,n){t=e(t),"/"!==t&&t||(t=i._defaultRoute)
var o,r=i._definedRoutes[t],u="",l=!1
if(!r)for(var d=0,c=i._regexRoutes.length;c>d;d++)o=i._regexRoutes[d],t.match(o.regex)&&(l=!0,o.action?o.action.apply(null,o.argmnts):o.state&&a.setGlobalState(o.state),o.title&&(u=o.title.replace(/\{title\}/,u)))
if(f&&!n){var g=i._routingMarker,R=location.href,p=R.substring(0,R.indexOf(g)+g.length),h=t===i._defaultRoute?p:p+t
window.history.pushState({reflux_route:t},(r?r.title:u)||null,h)}r&&(r.action?r.action.apply(null,r.argmnts):r.state&&a.setGlobalState(r.state))
var v=r&&r.title||u
return s&&v&&(document.title=v),r||l||i.onUnknownRoute(t),v||null},i})
