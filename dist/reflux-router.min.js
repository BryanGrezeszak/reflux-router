// v 1.0.0
// By Bryan Grezeszak 2016
// MIT License

!function(e,t){"function"==typeof define&&define.amd&&define(t),"object"==typeof module&&module.exports&&(module.exports=t()),"object"==typeof e&&"undefined"!=typeof Reflux&&(e.RefluxRouter=t())}(this,function(){"use strict"
function e(e){return e?e.replace(/^([^\/])|([^\/])$/g,"$2/$1"):"/"}function t(e){e&&e.state&&e.state.reflux_route?o.navigateTo(e.state.reflux_route,!0):o.navigateTo(o._defaultRoute,!0)}function n(e){var t=location.hash.substr(a.length)
o.navigateTo(t,!0)}var o={},i="undefined"!=typeof Reflux?Reflux:null,r=!1,a=null,u="object"==typeof window,l="object"==typeof document
return o._definedRoutes={},o._regexRoutes=[],o.defineReflux=function(e){i=e},o.initializeRouting=function(i,l,f){o._defaultRoute=e(i)
var s=f||(u?window.location.href:"")
s=s.replace(/\/$/,""),l=l.replace(/\/$/,"")
var d,c=s.indexOf(l)
if(r="#"===l.charAt(0),a=r?l:null,r&&u?window.addEventListener("hashchange",n):u&&window.addEventListener("popstate",t),r&&-1===c)d="/"
else if(-1===c)throw Error("Routing marker not found in current URL.")
return d=d||e(s.substr(c+l.length)),o.navigateTo(d,!0)},o.defineRoute=function(t,n,i,r){if(Array.isArray(i))var a=i
else{r=i
var a=void 0}if(Array.isArray(t))for(var u=0,l=t.length;l>u;u++)o.defineRoute(t[u],n,a,r)
else"string"==typeof t?(t=e(t),o._definedRoutes[t]={action:n,argmnts:a,title:r}):o._regexRoutes.push({regex:t,action:n,argmnts:a,title:r})},o.defineRouteState=function(t,n,i){if(Array.isArray(t))for(var r=0,a=t.length;a>r;r++)o.defineRouteState(t[r],n,i)
else"string"==typeof t?(t=e(t),o._definedRoutes[t]={state:n,title:i}):o._regexRoutes.push({regex:t,state:n,title:i})},o.navigateTo=function(t,n){t=e(t),"/"!==t&&t||(t=o._defaultRoute)
var r,a=o._definedRoutes[t],f=""
if(!a)for(var s=0,d=o._regexRoutes.length;d>s;s++)r=o._regexRoutes[s],t.match(r.regex)&&(r.action?r.action.apply(null,r.argmnts):r.state&&i.setGlobalState(r.state),r.title&&(f=r.title.replace(/\{title\}/,f)))
u&&!n&&window.history.pushState({reflux_route:t},(a?a.title:f)||null,t),a&&(a.action?a.action.apply(null,a.argmnts):a.state&&i.setGlobalState(a.state))
var c=a&&a.title||f
return l&&c&&(document.title=c),c||null},o})
