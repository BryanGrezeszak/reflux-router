// v 1.2.0
// By Bryan Grezeszak 2016
// MIT License

!function(a,b){"function"==typeof define&&define.amd&&define(b),"object"==typeof module&&module.exports&&(module.exports=b()),"object"==typeof a&&"undefined"!=typeof Reflux&&(a.RefluxRouter=b())}(this,function(){"use strict";function h(a){return a?a.replace(/^([^\/])|([^\/])$/g,"$2/$1"):"/"}function i(){var c=window.location.href;c=c.replace(/\/$/,"");var d=b._routingMarker,e=c.indexOf(d);if(e===-1)throw new Error(a);return h(c.substr(e+d.length))}function j(a){a&&a.state&&a.state.reflux_route?b.navigateTo(a.state.reflux_route,!0):b.navigateTo(i(),!0)}function k(a){var c=location.hash.substr(e.length);b.navigateTo(c,!0)}var a="Routing marker not found in current URL.",b={},c="undefined"!=typeof Reflux?Reflux:null,d=!1,e=null,f="object"==typeof window,g="object"==typeof document;return b._definedRoutes={},b._regexRoutes=[],b._routingMarker=null,b.defineReflux=function(a){c=a},b.initializeRouting=function(c,g,i){b._defaultRoute=h(c);var l=i||(f?window.location.href:"");l=l.replace(/\/$/,""),b._routingMarker=g=g.replace(/\/$/,"");var m,n=l.indexOf(g);if(d="#"===g.charAt(0),e=d?g:null,d&&f?window.addEventListener("hashchange",k):f&&window.addEventListener("popstate",j),d&&n===-1)m="/";else if(n===-1)throw new Error(a);return m=m||h(l.substr(n+g.length)),b.navigateTo(m,!0)},b.defineRoute=function(a,c,d,e){if(Array.isArray(d))var f=d;else{e=d;var f=void 0}if(Array.isArray(a))for(var g=0,i=a.length;g<i;g++)b.defineRoute(a[g],c,f,e);else"string"==typeof a?(a=h(a),b._definedRoutes[a]={action:c,argmnts:f,title:e}):b._regexRoutes.push({regex:a,action:c,argmnts:f,title:e})},b.defineRouteState=function(a,c,d){if(Array.isArray(a))for(var e=0,f=a.length;e<f;e++)b.defineRouteState(a[e],c,d);else"string"==typeof a?(a=h(a),b._definedRoutes[a]={state:c,title:d}):b._regexRoutes.push({regex:a,state:c,title:d})},b.onUnknownRoute=function(a){},b.navigateTo=function(a,d){a=h(a),"/"!==a&&a||(a=b._defaultRoute);var j,e=b._definedRoutes[a],i="",k=!1;if(!e)for(var l=0,m=b._regexRoutes.length;l<m;l++)j=b._regexRoutes[l],a.match(j.regex)&&(k=!0,j.action?j.action.apply(null,j.argmnts):j.state&&c.setGlobalState(j.state),j.title&&(i=j.title.replace(/\{title\}/,i)));if(f&&!d){var n=b._routingMarker,o=location.href,p=o.substring(0,o.indexOf(n)+n.length),q=a===b._defaultRoute?p:p+a;window.history.pushState({reflux_route:a},(e?e.title:i)||null,q)}e&&(e.action?e.action.apply(null,e.argmnts):e.state&&c.setGlobalState(e.state));var r=e&&e.title||i;return g&&r&&(document.title=r),e||k||b.onUnknownRoute(a),r||null},b.getRoute=function(){return d?h(location.hash.substr(e.length)):i()},b});
